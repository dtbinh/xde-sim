c = [0.127171   -1.18051    2.58154   -1.53329    1.40391   -2.17606  -0.668203;
    -0.613392  -0.382454   0.587747    1.08495   -1.35433 -0.0112875    0.97705];
k = [0   0   0   0 2.5   5 7.5  10  10  10  10];
nTp = 10.0;
nt = 2.6;
x = reshape(c, [1 2*ncp]);

nz = subs(z{2},
  {X(1),
  X(2),
  X(3),
  X(4),
  X(5),
  X(6),
  X(7),
  X(8),
  X(9),
  X(10),
  X(11),
  X(12),
  X(13),
  X(14),
  knots,
  t,
  Tp},
  {x(1),
  x(2),
  x(3),
  x(4),
  x(5),
  x(6),
  x(7),
  x(8),
  x(9),
  x(10),
  x(11),
  x(12),
  x(13),
  x(14),  
  k,
  nt,
  nTp});

ndz = subs(dz{2},
  {X(1),
  X(2),
  X(3),
  X(4),
  X(5),
  X(6),
  X(7),
  X(8),
  X(9),
  X(10),
  X(11),
  X(12),
  X(13),
  X(14),
  knots,
  t,
  Tp},
  {x(1),
  x(2),
  x(3),
  x(4),
  x(5),
  x(6),
  x(7),
  x(8),
  x(9),
  x(10),
  x(11),
  x(12),
  x(13),
  x(14),  
  k,
  nt,
  nTp});

nddz = subs(ddz{2},
  {X(1),
  X(2),
  X(3),
  X(4),
  X(5),
  X(6),
  X(7),
  X(8),
  X(9),
  X(10),
  X(11),
  X(12),
  X(13),
  X(14),
  knots,
  t,
  Tp},
  {x(1),
  x(2),
  x(3),
  x(4),
  x(5),
  x(6),
  x(7),
  x(8),
  x(9),
  x(10),
  x(11),
  x(12),
  x(13),
  x(14),  
  k,
  nt,
  nTp});
  
ndddz = subs(dddz{2},
  {X(1),
  X(2),
  X(3),
  X(4),
  X(5),
  X(6),
  X(7),
  X(8),
  X(9),
  X(10),
  X(11),
  X(12),
  X(13),
  X(14),
  knots,
  t, 
  Tp},
  {x(1),
  x(2),
  x(3),
  x(4),
  x(5),
  x(6),
  x(7),
  x(8),
  x(9),
  x(10),
  x(11),
  x(12),
  x(13),
  x(14),  
  k,
  nt,
  nTp});

vpa([nz ndz nddz ndddz])

nnz = vpa(bspevaluation(2, d, c, k, nt));
[dc dk] = bspderivative(d, c, k);
nndz = vpa(bspevaluation(2, d-1, dc, dk, nt));
[ddc ddk] = bspderivative(d-1, dc, dk);
nnddz = vpa(bspevaluation(2, d-2, ddc, ddk, nt));
[dddc dddk] = bspderivative(d-2, ddc, ddk);
nndddz = vpa(bspevaluation(2, d-3, dddc, dddk, nt));

nnz
nndz
nnddz
nndddz
